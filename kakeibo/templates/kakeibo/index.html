{% extends "base.html" %}
{% block title %}å®¶è¨ˆç°¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼{% endblock %}

{% block head %}
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
        <style>
            .container {
                font-family: 'Noto Sans JP', sans-serif;
            }
            a {
                text-decoration: none;
            }
            th {
                height: 30px;
                text-align: center;
            }
            td {
                height: 100px;
            }
            .today {
                background: orange !important;
            }
            #prev, #month, #next {
                display: inline-block;
                vertical-align: middle;
                margin: 0;
            }
            td:hover {
                background-color: yellow;
            }
            #prev:hover {
                background-color: yellow;
            }
            #next:hover {
                background-color: yellow;
            }
            #form-container {
                display: none;
            }
            .col-sm-4 {
                padding-right: 70px;
            }
            /* èƒŒæ™¯å¤‰ã‚ã‚‰ãªã„ğŸ˜¢*/
            .col-md-6.offset-md-3 {
                background-color: #fff; /* èƒŒæ™¯è‰²ã‚’è¨­å®š */
                background-image: url('/static/kakeibo.png'); /* èƒŒæ™¯ç”»åƒã‚’è¿½åŠ  */
            }
            #month {
                padding-left: 30px;
                padding-right: 30px;
            }
            .col-sm-8.offset-sm-2.text-center {
                padding-bottom: 50px;
            }
            .first-table th:first-child, td:nth-child(7n+1) {
                color: red;
                border-color: black;
            }
            .first-table th:last-child, td:nth-child(7n) {
                color: blue;
                border-color: black;
            }
        </style>
{% endblock %}
        
{% block main %}
    <main class="container-fluid py-5 text-center">
    <div class="first-table">
    <div class="container">
    <botton id="prev">ï¼œ</botton><h3 id="month"></h3><botton id="next">ï¼</botton>
    <p></p>
    <div id="calendar">
    <table class="table table-bordered">
        <tr>
            <th>æ—¥</th>
            <th>æœˆ</th>
            <th>ç«</th>
            <th>æ°´</th>
            <th>æœ¨</th>
            <th>é‡‘</th>
            <th>åœŸ</th>
        </tr>
        <tbody id="calendar-body">
        </tbody>
    </table>
    </div>
    </div>
    </div>
    </main>
    <div id="form-register">
        <div class="col-md-6 offset-md-3">
        <br>
        <h3>ï½ã€€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã€€ï½</h3>
        <p></p><br>
        <form>
            <div class="form-group row">
                <label for="date" class="col-sm-2 col-form-label">æ—¥ä»˜</label>
                <div class="col-sm-4">
                    <input type="date" class="form-control" id="regist_date" name="date">
                </div>
                <!-- å“ç›®ã®åˆ¶é™ã¯å¾Œã§åŠ ãˆã‚‹ -->
                <label for="name" class="col-sm-2 col-form-label">å“ç›®</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="regist_name" name="name">
                </div>
                <p></p>
            </div>
            <div class="form-group row">
                <label for="price" class="col-sm-2 col-form-label">å˜ä¾¡</label>
                <div class="col-sm-4">
                    <input type="number" class="form-control" id="regist_price" name="price" min="1">
                </div>
                <label for="date" class="col-sm-2 col-form-label">æ•°é‡</label>
                <div class="col-sm-4">
                    <input type="number" class="form-control" id="regist_quantity" name="quantity" min="1">
                </div>
                <p></p><br>
                <div class="col-sm-8 offset-sm-2 text-center">
                    <button type="submit" class="btn-primary btn-lg" id="regist_btn">ç™»éŒ²</button>
                </div>
            </div>
        </form>
        </div>
    </div>

    <p></p>
    <h3>ï½ã€€æ”¯å‡ºä¸€è¦§ã€€ï½</h3>
    <table id="Habs_tb" class="container" style="width: 50%;">
        <tr>
            <th>æ—¥ä»˜</th>
            <th>å“ç›®</th>
            <th>ç¨è¾¼ä¾¡æ ¼</th>
        </tr>
    </table>
    <script>
        var today = new Date();
        var currentMonth = today.getMonth();
        var currentYear = today.getFullYear();
        //var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var prevButton = document.getElementById("prev");
        var nextButton = document.getElementById("next");

        //å‰ã®æœˆã¸æˆ»ã‚‹
        prevButton.addEventListener("click", function() {
            currentYear = (currentMonth == 1) ? currentYear - 1 : currentYear;
            currentMonth = (currentMonth == 1) ? 12 : currentMonth - 1;
            displayCalendar();
        });

        //æ¬¡ã®æœˆã¸é€²ã‚€
        nextButton.addEventListener("click", function() {
            currentYear = (currentMonth == 12) ? currentYear + 1 : currentYear;
            currentMonth = (currentMonth == 12) ? 1 : currentMonth + 1;
            displayCalendar();
        });

        function displayCalendar() {
            var firstDay = (new Date(currentYear, currentMonth)).getDay();
            var daysInMonth = 32 - new Date(currentYear, currentMonth, 32).getDate();

            var calendarBody = document.getElementById("calendar-body");
            calendarBody.innerHTML = "";

            var monthYear = document.getElementById("month");
            var month = currentMonth % 12 + 1;
            monthYear.innerHTML = currentYear + "å¹´" + month + "æœˆ";

            var date = 1;
            for (var i = 0; i < 6; i++) {
                var row = document.createElement("tr");

                for (var j = 0; j < 7; j++) {
                    if (i === 0 && j < firstDay) {
                        var cell = document.createElement("td");
                        var cellText = document.createTextNode("");
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                    } else if (date > daysInMonth) {
                        break;
                    } else {
                        var cell = document.createElement("td");
                        var cellText = document.createTextNode(date);
                        if (date === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                            cell.classList.add("today");
                        }
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                        date++;
                    }
                }
                calendarBody.appendChild(row);
                //é€±ã®çµ‚ã‚ã‚Šã¾ã§ç©ºã®ç®±ã‚’ç”¨æ„ã™ã‚‹ã€‚
                if (date > daysInMonth) {
                    break;
                }
            }
        }
        displayCalendar();

        ///////////////////////////////////////////////////////////
        // ã“ã“ã¯ã€ã¾ã ã‚„ã‚Šæ–¹æ¨¡ç´¢ä¸­
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’è¡¨ç¤ºã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å–å¾—
        var calendarBody = document.getElementById("calendar-body");

        // æ—¥ä»˜ã‚»ãƒ«ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹
        calendarBody.addEventListener("click", function(e) {
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒtdè¦ç´ ã§ã‚ã‚‹å ´åˆã«ã®ã¿å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
            if (e.target && e.target.nodeName === "TD") {
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹
                var formContainer = document.getElementById("form-container");
                formContainer.style.display = "block";

                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ—¥ä»˜ã‚»ãƒ«ã®ä¸Šã«é…ç½®ã™ã‚‹
                var cellRect = e.target.getBoundingClientRect();
                var formHeight = formContainer.offsetHeight;
                formContainer.style.top = (cellRect.top - formHeight) + "px";
                formContainer.style.left = cellRect.left + "px";
            }
        });
        ///////////////////////////////////////////////////////////

        // ã€Œç™»éŒ²ã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        getElmId("regist_btn").addEventListener('click', registSpending, false);
        // ã€Œå¹´æœˆæ—¥ã€ã‚’é…åˆ—ã§å–å¾— ( [0]:å¹´, [1]:æœˆ, [2]:æ—¥ )
        var dateArray = getTSDate(today);

        ////////  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ•´åˆã¯å¾Œã§è€ƒãˆã‚‹ã€€////////
        // This is WEBSQL (WebSQLã¯ã€éæ¨å¥¨ã‚‰ã—ã„ã®ã§ã€å‡ºæ¥ã‚Œã°å¤‰ãˆã¦ã»ã—ã„)
        // DBæƒ…å ±ã‚’è¨­å®š
        var dbName = 'kakeibo';                                // DBå
        var dbVersion = '1.0';                                 // DBãƒãƒ¼ã‚¸ãƒ§ãƒ³
        var dbDescription = 'kakeibo_register_database';       // DBèª¬æ˜æ–‡
        var dbSize = 100000;                                   // DBã‚µã‚¤ã‚º
        var db = openDatabase(dbName, dbVersion, dbDescription, dbSize);
        // ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
        db.transaction(function(trns){
            trns.executeSql('create table if not exists Hab (id integer primary key autoincrement,name text not null,price int not null,quantity int not null,sum int not null,registed_at datetime)')
          }
        );
        ////////  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ•´åˆã¯å¾Œã§è€ƒãˆã‚‹ //////////
        
        // ç™»éŒ²æ—¥ä»˜ã«ã€Œæœ¬æ—¥ã®å¹´æœˆæ—¥ã€ã‚’è¨­å®š
        document.getElementById("regist_date").value = dateArray[0] + "-" + dateArray[1] + "-" + dateArray[2]
        /* è¨ˆç®—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ãƒ†ãƒ¼ãƒ–ãƒ«(æ—¥ä»˜, å“ç›®, ç¨è¾¼ä¾¡æ ¼, å‰Šé™¤ãƒœã‚¿ãƒ³, ç·¨é›†ãƒœã‚¿ãƒ³)ã‚’è¡¨ç¤º*/
        function execDisplayDesignatedPeriodData() {
            db.transaction(function (tx) {
                // SELECTæ–‡ã‚’å®Ÿè¡Œ
                tx.executeSql("select id, name, sum, registed_at from Hab ORDER BY registed_at ASC" , [],
                    function (tx, results) {
                        // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å–å¾—
                        var table = getElmId('Hab_tb');
                        // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ
                        table.innerHTML = "<tr><th>æ—¥ä»˜</th><th>å“ç›®</th><th colspan='3'>ç¨è¾¼ä¾¡æ ¼</th></tr>";
                        for (i = 0; i < results.rows.length; i++){
                            var rowData = results.rows.item(i);
                            var displayData = document.createElement('tr');
                            // ãƒ†ãƒ¼ãƒ–ãƒ«è­˜åˆ¥ç”¨idå±æ€§ä»˜åŠ 
                            displayData.setAttribute("id", rowData.id);
                            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
                            displayData.innerHTML = '<td>' + rowData.registed_at.split(' ')[0] + '</td><td>' + rowData.name + '</td><td class="sum">'+ rowData.sum + '</td><td><button class="delete_btn">å‰Šé™¤</button></td><td><button class="edit_btn">ç·¨é›†</button></td>';
                            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
                            table.appendChild(displayData);
                        }
                        //ã€Œå‰Šé™¤ã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                        var del_btns = getElmCls('delete_btn');
                        for(let btn of del_btns) {
                            btn.addEventListener('click', onClickDelBtn, false);
                        }
                        //ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                        var edit_btns = getElmCls('edit_btn');
                        for(let btn of edit_btns) {
                            btn.addEventListener('click', onClickEditBtn, false);
                        }
                   },
                   // ã‚¨ãƒ©ãƒ¼å‡¦ç†
                   function(transaction, error){
                       alert("ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚");
                   })
               }
           )
        }
        /* ãƒ‡ãƒ¼ã‚¿ç™»éŒ²å‡¦ç†*/
        function registSpending(){
            // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯
            if( chkRegistData('regist_date','regist_name', 'regist_price', 'regist_quantity') ){
                db.transaction(
                    function(trans){
                        // INSERTæ–‡ã‚’å®Ÿè¡Œ
                        trans.executeSql('INSERT INTO Hab (name, price, quantity, sum, registed_at) VALUES (?,?,?,?,?);', [getElmId('regist_name').value, getElmId('regist_price').value, getElmId('regist_quantity').value, Math.floor(getElmId('regist_price').value * getElmId('regist_quantity').value * 1.1), getElmId('regist_date').value + " 00:00:01"],
                            function(){
                                // è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                                execDisplayDesignatedPeriodData();
                                //ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ï¼ˆå“ç›®ãƒ»å˜ä¾¡ãƒ»å€‹æ•°ï¼‰ã®å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã®å€¤ã‚’åˆæœŸåŒ–
                                getElmId('regist_name').value = ""
                                getElmId('regist_price').value = ""
                                getElmId('regist_quantity').value = "";
                            },
                            // ã‚¨ãƒ©ãƒ¼å‡¦ç†
                            function(){
                                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã§ãã¾ã›ã‚“ã€‚');
                            }
                        );
                    }
                );
            }
        }
        /* ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯1 */
        function chkRegistData(date_id, name_id, price_id, quantity_id){
            var correctFlg = true;
            // æ—¥ä»˜ã®æ›¸å¼ãƒã‚§ãƒƒã‚¯
            if ( getElmId(date_id).value.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/g) === null){
                alert('ç™»éŒ²æ—¥ä»˜ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                correctFlg = false;
            }
            // å“ç›®ã®ãƒã‚§ãƒƒã‚¯
            if ( getElmId(name_id).value.length === 0 ){
                alert('å“ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                correctFlg = false;
            }
            // å˜ä¾¡ã®ãƒã‚§ãƒƒã‚¯
            if ( getElmId(price_id).value.length === 0 ){
                alert('å˜ä¾¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                correctFlg = false;
            } else {
                // å˜ä¾¡ã®æ›¸å¼ãƒã‚§ãƒƒã‚¯
                if ( getElmId(price_id).value.match(/^[0-9]*$/g) === null ){
                    alert('å˜ä¾¡ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                    correctFlg = false;
                }
            }
            // å€‹æ•°ã®ãƒã‚§ãƒƒã‚¯
            if ( getElmId(price_id).value.length === 0 ){
                alert('å€‹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                correctFlg = false;
            } else {
                // å€‹æ•°ã®æ›¸å¼ãƒã‚§ãƒƒã‚¯
                if ( getElmId(quantity_id).value.match(/^[0-9]*$/g) === null ){
                    alert('å€‹æ•°ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                    correctFlg = false;
                }
            }
            return correctFlg;
        }
        /* ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯2 */
        function chkRegistData2(date_id, name_id){
            var correctFlg = true;
            // æ—¥ä»˜ã®æ›¸å¼ãƒã‚§ãƒƒã‚¯
            if ( getElmId(date_id).value.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/g) === null){
                alert('ç™»éŒ²æ—¥ä»˜ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                correctFlg = false;
            }
            // å“ç›®ã®ãƒã‚§ãƒƒã‚¯
            if ( getElmId(name_id).value.length === 0 ){
                alert('å“ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                correctFlg = false;
            }
            return correctFlg;
        }
        /*ã€Œå‰Šé™¤ãƒœã‚¿ãƒ³ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç† */
        function onClickDelBtn(event){
            // ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
            if( confirm("ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ") ){
                // ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥ç”¨idå±æ€§ã®å€¤ã‚’å–å¾—
                var del_id = event.target.parentNode.parentNode.getAttribute("id");
                db.transaction(function(tx) {
                    // DELETEæ–‡ã‚’å®Ÿè¡Œ
                    tx.executeSql("delete from Hab where id='" + del_id + "'", [],
                        function () {
                            //ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                            execDisplayDesignatedPeriodData();
                        },
                        // ã‚¨ãƒ©ãƒ¼å‡¦ç†
                        function () {
                            alert('ãƒ‡ãƒ¼ã‚¿å‰Šé™¤å¤±æ•—');
                        }
                    )}
                );
            }
        }
        /*ã€Œç·¨é›†ãƒœã‚¿ãƒ³ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†*/
        function onClickEditBtn(event){
            // ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥ç”¨idå±æ€§ã®å€¤ã‚’å–å¾—
            var edit_id = event.target.parentNode.parentNode.getAttribute("id");
            // idå€¤ã®tdè¦ç´ ã‚’å–å¾—
            var td = getElmId(edit_id).children;
            // ãƒ†ãƒ¼ãƒ–ãƒ«è¦ç´ ã‚’å–å¾—
            var table = getElmId('Hab_tb');
            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ä½œæˆ
            table.innerHTML = "<tr><th>æ—¥ä»˜</th><th>å†…å®¹</th><th colspan='3'>ç¨è¾¼ä¾¡æ ¼</th></tr>";
            // ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã‚’ä½œæˆ
            var displayData = document.createElement('tr');
            // ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥ç”¨idå±æ€§ã‚’è¨­å®š
            displayData.setAttribute("id", edit_id);
            // ç·¨é›†ç”¨HTMLã‚³ãƒ¼ãƒ‰ä½œæˆ
            displayData.innerHTML = '<td><input type="date" id="edit_date" value="' + td[0].textContent.split(" ")[0] + '"></td><td><input type="text" id="edit_name" value="' + td[1].textContent + '"></td><td>' + td[2].textContent + '</td><td><button id="edit_exec_btn">ç·¨é›†å®Ÿè¡Œ</button></td>';
            //ç·¨é›†ç”¨HTMLã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨­å®š
            table.appendChild(displayData);
            // ã€Œç·¨é›†å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            getElmId('edit_exec_btn').addEventListener('click', onClickEditExecBtn, false);
        }
        /* ãƒ‡ãƒ¼ã‚¿æ›´æ–°å‡¦ç† */
        function onClickEditExecBtn(event){
            if ( chkRegistData2('edit_date', 'edit_name') ){
                // ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥ç”¨idå±æ€§ã®å€¤ã‚’å–å¾—
                var edit_id = event.target.parentNode.parentNode.getAttribute("id");
                // ç™»éŒ²ç”¨ã€Œå¹´æœˆæ—¥ã€æ™‚é–“ã‚’ä½œæˆ
                var regist_date = getElmId('edit_date').value + ' 00:00:01';
                db.transaction(function(tx) {
                    // UPDATEæ–‡ã‚’å®Ÿè¡Œ
                    tx.executeSql("update Hab set name = '" + getElmId('edit_name').value + "', registed_at = '" + regist_date + "' where id='" + edit_id + "'", [],
                        function () {
                            //ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                            execDisplayDesignatedPeriodData();
                            alert('ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚');
                        },
                        // ã‚¨ãƒ©ãƒ¼å‡¦ç†
                        function () {
                            alert('ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã§ãã¾ã›ã‚“ã€‚');
                        }
                    )}
                );
            }
        }
        /* IDåã‹ã‚‰DOMã‚’å–å¾— */
        function getElmId(id){
            return document.getElementById(id);
        }
        /* Classåã‹ã‚‰DOMã‚’å–å¾— */
        function getElmCls(contents){
            return document.getElementsByClassName(contents);
        }
        /* ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‹ã‚‰å¹´æœˆæ—¥æ–‡å­—åˆ—ã‚’å–å¾— */       
        function getTSDate(date){
            var dateArray = new Array();
            dateArray.push(zero_pad(date.getFullYear(),4));
            dateArray.push(zero_pad(date.getMonth() + 1,2));
            dateArray.push(zero_pad(date.getDate(),2));
            return dateArray;
        }
        /* ï¼è©°å‡¦ç† */
        function zero_pad(val, show_length){
            var str_val = String(val);
            if( str_val.length < show_length ){
                var zero = ""; 
                for(var i = 0; i < ( show_length - str_val.length ); i++){
                    zero += "0";
                }
                str_val = zero + str_val;
            }
            return str_val;
        };

    </script>
{% endblock %}
